<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>芜湖起飞 - 航空订票系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E88E5',
                        secondary: '#FF9800',
                        success: '#4CAF50',
                        danger: '#F44336',
                    },
                },
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .nav-active {
                border-bottom: 2px solid #1E88E5;
                color: #1E88E5;
            }
            .dropdown-toggle {
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='2'%3E%3Cpath d='M2 5l6 6 6-6'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 0.5rem center;
                background-size: 12px;
            }
            .flight-card {
                @apply bg-white rounded-lg shadow-sm border border-gray-100 p-4 hover:shadow-md transition-shadow;
            }
            .order-card {
                @apply bg-white rounded-lg shadow-sm border border-gray-100 p-4 mb-4 hover:shadow-md transition-shadow;
            }
            .status-tag {
                @apply text-xs px-2 py-1 rounded-full;
            }
            .status-hold {
                @apply bg-yellow-100 text-yellow-800;
            }
            .status-confirmed {
                @apply bg-green-100 text-green-800;
            }
            .status-cancelled {
                @apply bg-gray-100 text-gray-800;
            }
        }
    </style>
</head>

<body class="bg-gray-50">
<!-- 顶部导航栏 -->
<header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
            <!-- 品牌标识 -->
            <div class="flex items-center">
                <i class="fa fa-paper-plane text-primary text-2xl mr-2"></i>
                <h1 class="text-xl font-bold text-gray-800">芜湖起飞</h1>
            </div>

            <!-- 导航菜单 -->
            <nav class="flex space-x-8">
                <a href="#" class="nav-link nav-active px-1 py-5 font-medium" id="nav-flight">航班预订</a>
                <a href="#" class="nav-link px-1 py-5 font-medium text-gray-600" id="nav-order">订单管理</a>
                <a href="#" class="nav-link px-1 py-5 font-medium text-gray-600" id="nav-profile">个人中心</a>
            </nav>

            <!-- 登录按钮 -->
            <div>
                <button class="px-4 py-2 text-sm font-medium text-primary border border-primary rounded-full hover:bg-primary/5 transition-colors">
                    <i class="fa fa-sign-in mr-1"></i> 登录
                </button>
            </div>
        </div>
    </div>
</header>

<main class="container mx-auto px-4 py-6">
    <!-- 航班预订页面 -->
    <section id="section-flight" class="block">
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-2xl font-bold mb-6">航班查询</h2>
            <form id="flight-search-form" class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <!-- 出发机场 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">出发机场</label>
                    <div class="relative">
                        <i class="fa fa-map-marker absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <select id="depart-airport" class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none dropdown-toggle">
                            <option value="PEK">北京首都国际机场 (PEK)</option>
                            <option value="CAN">广州白云国际机场 (CAN)</option>
                            <option value="SHA">上海虹桥国际机场 (SHA)</option>
                            <option value="PVG">上海浦东国际机场 (PVG)</option>
                        </select>
                    </div>
                </div>

                <!-- 到达机场 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">到达机场</label>
                    <div class="relative">
                        <i class="fa fa-map-marker absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <select id="arrival-airport" class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none dropdown-toggle">
                            <option value="CAN">广州白云国际机场 (CAN)</option>
                            <option value="PEK">北京首都国际机场 (PEK)</option>
                            <option value="SHA">上海虹桥国际机场 (SHA)</option>
                            <option value="PVG">上海浦东国际机场 (PVG)</option>
                        </select>
                    </div>
                </div>

                <!-- 出发日期 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">出发日期</label>
                    <div class="relative">
                        <i class="fa fa-calendar absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="date" id="flight-date" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
                    </div>
                </div>

                <!-- 乘客人数 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">乘客人数</label>
                    <div class="relative">
                        <i class="fa fa-user absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <select id="passenger-count" class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none dropdown-toggle">
                            <option value="1">1成人</option>
                            <option value="2">2成人</option>
                            <option value="3">3成人</option>
                        </select>
                    </div>
                </div>

                <!-- 排序方式 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">排序方式</label>
                    <select id="sort-type" class="w-full px-4 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none dropdown-toggle">
                        <option value="DEFAULT">默认排序</option>
                        <option value="PRICE">价格最低</option>
                        <option value="TIME">耗时最短</option>
                    </select>
                </div>

                <!-- 搜索按钮 -->
                <div class="flex items-end col-span-5 md:col-span-1">
                    <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition flex items-center justify-center">
                        <i class="fa fa-search mr-2"></i> 搜索航班
                    </button>
                </div>
            </form>
        </div>

        <!-- 航空公司筛选 -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
            <div class="flex flex-wrap items-center gap-4">
                <span class="text-gray-600">航空公司：</span>
                <button class="px-3 py-1 text-sm bg-primary/10 text-primary rounded-full">全选</button>
                <button class="px-3 py-1 text-sm bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-full transition">中国国际航空 (CA)</button>
                <button class="px-3 py-1 text-sm bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-full transition">中国南方航空 (CZ)</button>
                <button class="px-3 py-1 text-sm bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-full transition">海南航空 (HU)</button>
                <button class="px-3 py-1 text-sm bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-full transition">深圳航空 (ZH)</button>
            </div>
        </div>

        <!-- 航班列表容器 -->
        <div id="flight-list" class="space-y-4 mb-8">
            <!-- 航班列表将通过JS动态加载 -->
        </div>
    </section>

    <!-- 订单管理页面 -->
    <section id="section-order" class="hidden">
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-2xl font-bold mb-6">我的订单</h2>
            <div class="flex flex-wrap gap-4 mb-6">
                <button class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium">全部订单</button>
                <button class="px-4 py-2 bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-lg text-sm font-medium transition">待支付</button>
                <button class="px-4 py-2 bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-lg text-sm font-medium transition">已支付</button>
                <button class="px-4 py-2 bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-lg text-sm font-medium transition">已完成</button>
                <button class="px-4 py-2 bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-lg text-sm font-medium transition">已取消</button>
            </div>
            <div class="relative">
                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input type="text" placeholder="请输入订单号或证件号查询" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
            </div>
        </div>

        <!-- 订单列表容器 -->
        <div id="order-list" class="space-y-4 mb-8">
            <!-- 订单列表将通过JS动态加载 -->
        </div>
    </section>

    <!-- 个人中心页面 -->
    <section id="section-profile" class="hidden">
        <div class="text-center py-10 text-gray-500">
            <i class="fa fa-user text-4xl mb-3"></i>
            <p>个人中心功能</p>
        </div>
    </section>

    <!-- 预订航班模态框 -->
    <div id="book-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold" id="book-modal-title">预订航班</h3>
                <button id="close-book-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <p id="book-modal-info" class="text-gray-600 mb-4"></p>
            <input type="hidden" id="flight-instance-id">
            <input type="hidden" id="flight-number">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">乘客姓名</label>
                <input type="text" id="passenger-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="请输入乘客姓名">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">证件号码</label>
                <input type="text" id="id-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="请输入身份证号">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">手机号码</label>
                <input type="text" id="phone-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="请输入手机号码" value="13800138000">
            </div>
            <div class="flex space-x-3">
                <button id="confirm-book" class="flex-1 px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition">
                    确认预订
                </button>
                <button id="cancel-book" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 取消订单模态框 -->
    <div id="cancel-order-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">取消订单</h3>
                <button id="close-cancel-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <input type="hidden" id="cancel-booking-id">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">取消原因（可选）</label>
                <textarea id="cancel-reason" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" rows="3" placeholder="请输入取消原因"></textarea>
            </div>
            <div class="flex space-x-3">
                <button id="confirm-cancel" class="flex-1 px-4 py-2 bg-danger hover:bg-danger/90 text-white rounded-lg transition">
                    确认取消
                </button>
                <button id="cancel-cancel" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 操作结果提示模态框 -->
    <div id="result-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 text-center">
            <div id="result-icon" class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 text-green-500 mb-4">
                <i class="fa fa-check text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-2" id="result-title">操作成功</h3>
            <p class="text-gray-600 mb-6" id="result-message">订单已成功提交</p>
            <button id="close-result-modal" class="w-full px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition">
                确定
            </button>
        </div>
    </div>
</main>

<footer class="bg-gray-800 text-white mt-12 py-8">
    <div class="container mx-auto px-4 text-center">
        <p>© 2025 芜湖起飞 版权所有</p>
    </div>
</footer>

<script>
    // 页面导航切换
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();

            // 隐藏所有页面
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('hidden');
            });

            // 显示目标页面
            const targetId = this.getAttribute('id').split('-')[1];
            document.getElementById(`section-${targetId}`).classList.remove('hidden');

            // 更新导航样式
            document.querySelectorAll('.nav-link').forEach(item => {
                item.classList.remove('nav-active', 'text-primary');
                item.classList.add('text-gray-600');
            });
            this.classList.remove('text-gray-600');
            this.classList.add('nav-active', 'text-primary');

            // 订单管理页面加载订单
            if (targetId === 'order') {
                loadOrders();
            }
        });
    });

    // 初始化日期为今天
    window.addEventListener('load', function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('flight-date').value = today;
        // 触发一次搜索，显示初始航班列表
        document.getElementById('flight-search-form').dispatchEvent(new Event('submit'));
    });

    // 航班搜索
    document.getElementById('flight-search-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const departAirport = document.getElementById('depart-airport').value;
        const arrivalAirport = document.getElementById('arrival-airport').value;
        const flightDate = document.getElementById('flight-date').value;
        const passengerCount = document.getElementById('passenger-count').value;
        const sortType = document.getElementById('sort-type').value;

        // 构造请求数据
        const requestData = {
            departCity: departAirport,
            arrivalCity: arrivalAirport,
            flightDate: flightDate,
            passengerCount: parseInt(passengerCount),
            sortType: sortType
        };

        // 显示加载状态
        document.getElementById('flight-list').innerHTML = `
        <div class="text-center py-10 text-gray-500">
          <i class="fa fa-spinner fa-spin text-4xl mb-3"></i>
          <p>正在搜索航班，请稍候...</p>
        </div>
      `;

        // 调用航班搜索接口
        fetch('http://localhost:8080/api/flights/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('航班搜索失败');
                }
                return response.json();
            })
            .then(data => {
                renderFlightList(data);
            })
            .catch(error => {
                console.error('航班搜索错误:', error);
                document.getElementById('flight-list').innerHTML = `
          <div class="text-center py-10 text-red-500">
            <i class="fa fa-exclamation-triangle text-4xl mb-3"></i>
            <p>航班搜索失败：${error.message}</p>
          </div>
        `;
            });
    });

    // 渲染航班列表
    function renderFlightList(flights) {
        if (flights.length === 0) {
            document.getElementById('flight-list').innerHTML = `
          <div class="text-center py-10 text-gray-500">
            <i class="fa fa-plane text-4xl mb-3"></i>
            <p>未找到符合条件的航班</p>
          </div>
        `;
            return;
        }

        let html = '';
        flights.forEach(flight => {
            // 格式化时间和时长
            const departTime = new Date(flight.departDatetime).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            const arrivalTime = new Date(flight.arrivalDatetime).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            const durationHours = Math.floor(flight.flightDurationMin / 60);
            const durationMins = flight.flightDurationMin % 60;
            const durationStr = `${durationHours}小时${durationMins}分钟`;

            html += `
          <div class="flight-card">
            <div class="flex flex-wrap">
              <div class="w-full md:w-1/5 mb-4 md:mb-0">
                <div class="font-medium">${flight.airlineName}</div>
                <div class="text-sm text-gray-500">${flight.flightNumber} ${flight.aircraftName}</div>
              </div>
              <div class="w-full md:w-2/5 flex items-center justify-center mb-4 md:mb-0">
                <div class="text-center">
                  <div class="text-xl font-bold">${departTime}</div>
                  <div class="text-sm text-gray-500">${flight.departAirportName}</div>
                </div>
                <div class="mx-4 flex-1 max-w-[120px]">
                  <div class="relative">
                    <div class="border-t-2 border-dashed border-gray-300 relative z-0"></div>
                    <div class="absolute left-0 top-0 w-full flex justify-center">
                      <div class="text-xs text-gray-500">${durationStr}</div>
                    </div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="text-xl font-bold">${arrivalTime}</div>
                  <div class="text-sm text-gray-500">${flight.arrivalAirportName}</div>
                </div>
              </div>
              <div class="w-full md:w-1/5 flex flex-col items-center justify-center mb-4 md:mb-0">
                <div class="text-xl font-bold text-danger">¥${flight.price}</div>
              </div>
              <div class="w-full md:w-1/5 flex flex-col items-center justify-center">
                <button class="book-btn px-4 py-2 bg-secondary hover:bg-secondary/90 text-white font-medium rounded-lg transition"
                  data-instance-id="${flight.instanceId}"
                  data-flight-number="${flight.flightNumber}"
                  data-airline-name="${flight.airlineName}"
                  data-depart-airport="${flight.departAirportName}"
                  data-arrival-airport="${flight.arrivalAirportName}"
                  data-depart-time="${departTime}"
                  data-arrival-time="${arrivalTime}">
                  立即预订
                </button>
              </div>
            </div>
          </div>
        `;
        });

        document.getElementById('flight-list').innerHTML = html;

        // 绑定预订按钮事件
        document.querySelectorAll('.book-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const instanceId = this.getAttribute('data-instance-id');
                const flightNumber = this.getAttribute('data-flight-number');
                const airlineName = this.getAttribute('data-airline-name');
                const departAirport = this.getAttribute('data-depart-airport');
                const arrivalAirport = this.getAttribute('data-arrival-airport');
                const departTime = this.getAttribute('data-depart-time');
                const arrivalTime = this.getAttribute('data-arrival-time');

                document.getElementById('flight-instance-id').value = instanceId;
                document.getElementById('flight-number').value = flightNumber;
                document.getElementById('book-modal-title').textContent = `预订航班 - ${flightNumber}`;
                document.getElementById('book-modal-info').textContent = `${departAirport} → ${arrivalAirport} | ${departTime} - ${arrivalTime}`;
                document.getElementById('book-modal').classList.remove('hidden');
            });
        });
    }

    // 关闭预订模态框
    document.getElementById('close-book-modal').addEventListener('click', function() {
        document.getElementById('book-modal').classList.add('hidden');
    });

    document.getElementById('cancel-book').addEventListener('click', function() {
        document.getElementById('book-modal').classList.add('hidden');
    });

    // 确认预订
    document.getElementById('confirm-book').addEventListener('click', function() {
        const instanceId = document.getElementById('flight-instance-id').value;
        const passengerName = document.getElementById('passenger-name').value;
        const idNumber = document.getElementById('id-number').value;
        const phoneNumber = document.getElementById('phone-number').value;

        if (!passengerName || !idNumber || !phoneNumber) {
            alert('请填写完整乘客信息');
            return;
        }

        const requestData = {
            instanceId: instanceId,
            passengers: [{
                passengerName: passengerName,
                idType: 'ID_CARD',
                idNumber: idNumber,
                phone: phoneNumber,
                passengerType: 'ADULT',
                seatPreference: 'WINDOW'
            }],
            seatNumbers: [], // 实际场景需选择座位后传入，此处简化演示
            contactPassengerIndex: 0,
            clientToken: 'client_' + Date.now(),
            remark: ''
        };

        fetch('http://localhost:8080/api/bookings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('创建订单失败');
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('result-title').textContent = '预订成功';
                document.getElementById('result-message').textContent = `订单号：${data.bookingId}，请在15分钟内完成支付`;
                document.getElementById('book-modal').classList.add('hidden');
                document.getElementById('result-modal').classList.remove('hidden');
            })
            .catch(error => {
                console.error('创建订单错误:', error);
                document.getElementById('result-icon').className = 'inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 text-red-500 mb-4';
                document.getElementById('result-title').textContent = '预订失败';
                document.getElementById('result-message').textContent = error.message;
                document.getElementById('book-modal').classList.add('hidden');
                document.getElementById('result-modal').classList.remove('hidden');
            });
    });

    // 加载订单
    function loadOrders() {
        document.getElementById('order-list').innerHTML = `
        <div class="text-center py-10 text-gray-500">
          <i class="fa fa-spinner fa-spin text-4xl mb-3"></i>
          <p>正在加载订单，请稍候...</p>
        </div>
      `;

        fetch('http://localhost:8080/api/bookings/my-bookings?phone=13800138000', {
            method: 'GET'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('查询订单失败');
                }
                return response.json();
            })
            .then(data => {
                if (data.length === 0) {
                    document.getElementById('order-list').innerHTML = `
            <div class="text-center py-10 text-gray-500">
              <i class="fa fa-list-alt text-4xl mb-3"></i>
              <p>暂无订单记录</p>
            </div>
          `;
                    return;
                }

                let html = '';
                data.forEach(order => {
                    // 订单状态样式
                    let statusClass = '';
                    let statusText = '';
                    if (order.status === 'HOLD') {
                        statusClass = 'status-hold';
                        statusText = '待支付';
                    } else if (order.status === 'CONFIRMED') {
                        statusClass = 'status-confirmed';
                        statusText = '已支付';
                    } else if (order.status === 'CANCELLED') {
                        statusClass = 'status-cancelled';
                        statusText = '已取消';
                    }

                    html += `
            <div class="order-card">
              <div class="flex justify-between items-center mb-4">
                <div>
                  <span class="font-medium">订单号：${order.bookingId}</span>
                  <span class="ml-3 status-tag ${statusClass}">${statusText}</span>
                </div>
                <span class="text-sm text-gray-500">${new Date(order.bookingTime).toLocaleString()}</span>
              </div>
              <div class="flex flex-wrap">
                <div class="w-full md:w-2/3 mb-4 md:mb-0">
                  <div class="font-medium">${order.flightNumber} ${order.airlineName}</div>
                  <div class="flex items-center mt-2">
                    <div class="text-sm">
                      <span class="font-medium">${new Date(order.departDatetime).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}</span>
                      <span class="text-gray-500 ml-2">${order.departAirportName}</span>
                    </div>
                    <div class="mx-4 flex items-center">
                      <i class="fa fa-plane text-primary"></i>
                    </div>
                    <div class="text-sm">
                      <span class="font-medium">${new Date(order.arrivalDatetime).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}</span>
                      <span class="text-gray-500 ml-2">${order.arrivalAirportName}</span>
                    </div>
                  </div>
                  <div class="text-sm text-gray-500 mt-2">
                    乘客：${order.passengerNames.join(', ')}
                  </div>
                </div>
                <div class="w-full md:w-1/3 flex flex-col items-end justify-center">
                  <div class="text-right">
                    <div class="text-sm text-gray-500">总价</div>
                    <div class="text-xl font-bold text-danger">¥${order.totalPrice}</div>
                  </div>
                  <div class="flex space-x-3 mt-4">
                    <button class="view-btn px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition"
                      data-booking-id="${order.bookingId}">
                      查看详情
                    </button>
                    ${order.cancellable ? `
                      <button class="cancel-btn px-4 py-2 bg-danger hover:bg-danger/90 text-white rounded-lg transition"
                        data-booking-id="${order.bookingId}">
                        取消订单
                      </button>
                    ` : ''}
                  </div>
                </div>
              </div>
            </div>
          `;
                });

                document.getElementById('order-list').innerHTML = html;

                // 绑定取消订单按钮事件
                document.querySelectorAll('.cancel-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const bookingId = this.getAttribute('data-booking-id');
                        document.getElementById('cancel-booking-id').value = bookingId;
                        document.getElementById('cancel-order-modal').classList.remove('hidden');
                    });
                });
            })
            .catch(error => {
                console.error('查询订单错误:', error);
                document.getElementById('order-list').innerHTML = `
          <div class="text-center py-10 text-red-500">
            <i class="fa fa-exclamation-triangle text-4xl mb-3"></i>
            <p>查询订单失败：${error.message}</p>
          </div>
        `;
            });
    }

    // 关闭取消订单模态框
    document.getElementById('close-cancel-modal').addEventListener('click', function() {
        document.getElementById('cancel-order-modal').classList.add('hidden');
    });

    document.getElementById('cancel-cancel').addEventListener('click', function() {
        document.getElementById('cancel-order-modal').classList.add('hidden');
    });

    // 确认取消订单
    document.getElementById('confirm-cancel').addEventListener('click', function() {
        const bookingId = document.getElementById('cancel-booking-id').value;
        const cancelReason = document.getElementById('cancel-reason').value || '用户主动取消';

        fetch('http://localhost:8080/api/bookings/cancel', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                bookingId: bookingId,
                cancelReason: cancelReason
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('取消订单失败');
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('result-title').textContent = '取消成功';
                document.getElementById('result-message').textContent = data.message;
                document.getElementById('cancel-order-modal').classList.add('hidden');
                document.getElementById('result-modal').classList.remove('hidden');
                loadOrders(); // 刷新订单列表
            })
            .catch(error => {
                console.error('取消订单错误:', error);
                document.getElementById('result-icon').className = 'inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 text-red-500 mb-4';
                document.getElementById('result-title').textContent = '取消失败';
                document.getElementById('result-message').textContent = error.message;
                document.getElementById('cancel-order-modal').classList.add('hidden');
                document.getElementById('result-modal').classList.remove('hidden');
            });
    });

    // 关闭结果模态框
    document.getElementById('close-result-modal').addEventListener('click', function() {
        document.getElementById('result-modal').classList.add('hidden');
    });
</script>
</body>
</html>